<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°å­—å›¾åƒå¤„ç†åˆ†æç³»ç»Ÿ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: "Microsoft YaHei", sans-serif; background: #f5f7fa; color: #333; }
        
        .header { background: linear-gradient(135deg, #1a365d, #2c5282); color: white; padding: 15px 20px; }
        .header h1 { font-size: 18px; }
        .header p { font-size: 12px; opacity: 0.8; }
        
        .container { max-width: 1200px; margin: 20px auto; padding: 0 20px; }
        
        .layout { display: flex; gap: 20px; }
        .left-panel { width: 300px; flex-shrink: 0; }
        .right-panel { flex: 1; }
        
        .card { background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 15px; overflow: hidden; }
        .card-title { background: #2c5282; color: white; padding: 10px 15px; font-size: 14px; font-weight: bold; }
        .card-body { padding: 15px; }
        
        .upload-box { border: 2px dashed #ccc; border-radius: 8px; padding: 20px; text-align: center; cursor: pointer; }
        .upload-box:hover { border-color: #3182ce; background: #f0f7ff; }
        .upload-box .icon { font-size: 36px; }
        .upload-box p { color: #666; font-size: 13px; margin-top: 8px; }
        #fileInput { display: none; }
        
        .preview { margin-top: 10px; display: none; }
        .preview.show { display: block; }
        .preview img { width: 100%; max-height: 150px; object-fit: contain; border: 1px solid #ddd; border-radius: 4px; }
        .preview .info { font-size: 11px; color: #666; margin-top: 5px; background: #f5f5f5; padding: 5px; border-radius: 4px; }
        
        .section-title { font-size: 13px; font-weight: bold; color: #2c5282; margin: 12px 0 8px 0; padding-bottom: 5px; border-bottom: 2px solid #3182ce; display: flex; align-items: center; gap: 5px; }
        .section-title .badge { background: #3182ce; color: white; width: 18px; height: 18px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 10px; }
        
        .algo-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; }
        .algo-btn { padding: 7px 8px; border: 1px solid #ddd; border-radius: 4px; background: white; font-size: 12px; cursor: pointer; transition: all 0.2s; text-align: center; }
        .algo-btn:hover { border-color: #3182ce; background: #f0f7ff; }
        .algo-btn.selected { background: #3182ce; color: white; border-color: #3182ce; }
        
        .selected-info { background: #e8f4fd; border: 1px solid #bee3f8; border-radius: 4px; padding: 8px 12px; margin: 10px 0; font-size: 12px; color: #2c5282; }
        
        .action-btns { display: flex; gap: 8px; margin-top: 10px; }
        .btn { flex: 1; padding: 10px; border: none; border-radius: 6px; font-size: 13px; font-weight: bold; cursor: pointer; }
        .btn-primary { background: #38a169; color: white; }
        .btn-primary:hover { background: #2f855a; }
        .btn-primary:disabled { background: #a0aec0; cursor: not-allowed; }
        .btn-secondary { background: #e2e8f0; color: #4a5568; }
        .btn-secondary:hover { background: #cbd5e0; }
        
        .intro h3 { color: #2c5282; font-size: 15px; margin-bottom: 10px; }
        .intro p { color: #666; font-size: 13px; line-height: 1.8; }
        .features { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .feature { background: #f0fff4; border: 1px solid #c6f6d5; border-radius: 6px; padding: 10px; font-size: 12px; }
        .feature strong { color: #276749; }
        
        .loading { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255,255,255,0.95); z-index: 1000; justify-content: center; align-items: center; flex-direction: column; }
        .loading.show { display: flex; }
        .spinner { width: 40px; height: 40px; border: 3px solid #e2e8f0; border-top-color: #3182ce; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loading p { margin-top: 15px; color: #666; }
        
        .footer { text-align: center; padding: 15px; color: #999; font-size: 12px; }
        
        @media (max-width: 800px) {
            .layout { flex-direction: column; }
            .left-panel { width: 100%; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ“Š æ•°å­—å›¾åƒå¤„ç†åˆ†æç³»ç»Ÿ</h1>
        <p>æ­¦æ±‰è½»å·¥å¤§å­¦ Â· ç³»ç»Ÿç»¼åˆè®¾è®¡è¯¾ç¨‹é¡¹ç›®</p>
    </div>

    <div class="container">
        <div class="layout">
            <div class="left-panel">
                <div class="card">
                    <div class="card-title">ğŸ“¤ ä¸Šä¼ å›¾åƒ</div>
                    <div class="card-body">
                        <div class="upload-box" id="uploadBox">
                            <div class="icon">ğŸ–¼ï¸</div>
                            <p>ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ å›¾ç‰‡</p>
                            <input type="file" id="fileInput" accept="image/*">
                        </div>
                        <div class="preview" id="preview">
                            <img id="previewImg" src="" alt="é¢„è§ˆ">
                            <div class="info" id="fileInfo"></div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">âš™ï¸ é€‰æ‹©å¤„ç†åŠŸèƒ½ï¼ˆå¯å¤šé€‰ï¼‰</div>
                    <div class="card-body">
                        
                        <div class="section-title"><span class="badge">1</span> å›¾åƒåˆ†å‰²</div>
                        <div class="algo-grid">
                            <button class="algo-btn" data-algo="threshold">å›ºå®šé˜ˆå€¼</button>
                            <button class="algo-btn" data-algo="otsu">Otsué˜ˆå€¼</button>
                            <button class="algo-btn" data-algo="kmeans">K-means</button>
                            <button class="algo-btn" data-algo="watershed">åˆ†æ°´å²­</button>
                        </div>

                        <div class="section-title"><span class="badge">2</span> å¢å¼ºä¸å¤åŸ</div>
                        <div class="algo-grid">
                            <button class="algo-btn" data-algo="histogram_eq">ç›´æ–¹å›¾å‡è¡¡</button>
                            <button class="algo-btn" data-algo="clahe">CLAHE</button>
                            <button class="algo-btn" data-algo="gamma">ä¼½é©¬æ ¡æ­£</button>
                            <button class="algo-btn" data-algo="sharpen">é”åŒ–å¢å¼º</button>
                            <button class="algo-btn" data-algo="wiener">ç»´çº³æ»¤æ³¢</button>
                        </div>

                        <div class="section-title"><span class="badge">3</span> è¾¹ç¼˜æ£€æµ‹</div>
                        <div class="algo-grid">
                            <button class="algo-btn" data-algo="edge_multi">å¤šç®—å­å¯¹æ¯”</button>
                            <button class="algo-btn" data-algo="canny">Cannyæ£€æµ‹</button>
                        </div>

                        <div class="section-title"><span class="badge">4</span> æ¶ˆå™ª</div>
                        <div class="algo-grid">
                            <button class="algo-btn" data-algo="denoise_multi">å¤šæ–¹æ³•å¯¹æ¯”</button>
                            <button class="algo-btn" data-algo="gaussian_denoise">é«˜æ–¯æ»¤æ³¢</button>
                            <button class="algo-btn" data-algo="median_denoise">ä¸­å€¼æ»¤æ³¢</button>
                        </div>

                        <div class="section-title"><span class="badge">5</span> å‹ç¼©</div>
                        <div class="algo-grid">
                            <button class="algo-btn" data-algo="jpeg">JPEGå‹ç¼©</button>
                            <button class="algo-btn" data-algo="dct">DCTå˜æ¢</button>
                        </div>

                        <div class="selected-info" id="selectedInfo">å·²é€‰æ‹© 0 ä¸ªåŠŸèƒ½</div>
                        
                        <div class="action-btns">
                            <button class="btn btn-secondary" id="clearBtn">æ¸…ç©ºé€‰æ‹©</button>
                            <button class="btn btn-primary" id="processBtn" disabled>å¼€å§‹å¤„ç†</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="right-panel">
                <div class="card">
                    <div class="card-title">ğŸ“š ç³»ç»Ÿè¯´æ˜</div>
                    <div class="card-body intro">
                        <h3>é¢˜ç›®è¦æ±‚</h3>
                        <p>å¯¹å›¾åƒè¿›è¡Œ<strong>åˆ†å‰²ã€å¢å¼ºä¸å¤åŸã€è¾¹ç¼˜æ£€æµ‹ã€æ¶ˆå™ªã€å‹ç¼©</strong>ç­‰å¤„ç†ã€‚æœ¬ç³»ç»Ÿæ”¯æŒä¸€æ¬¡é€‰æ‹©å¤šä¸ªå¤„ç†åŠŸèƒ½ï¼Œæ‰¹é‡ç”Ÿæˆåˆ†æç»“æœã€‚</p>
                        <div class="features">
                            <div class="feature"><strong>å›¾åƒåˆ†å‰²</strong><br>é˜ˆå€¼åˆ†å‰²ã€K-meansã€åˆ†æ°´å²­</div>
                            <div class="feature"><strong>å¢å¼ºå¤åŸ</strong><br>ç›´æ–¹å›¾å‡è¡¡ã€CLAHEã€ç»´çº³æ»¤æ³¢</div>
                            <div class="feature"><strong>è¾¹ç¼˜æ£€æµ‹</strong><br>Cannyã€Sobelã€Laplacianç­‰</div>
                            <div class="feature"><strong>æ¶ˆå™ªå¤„ç†</strong><br>é«˜æ–¯ã€ä¸­å€¼ã€åŒè¾¹ã€NLM</div>
                            <div class="feature"><strong>å›¾åƒå‹ç¼©</strong><br>JPEGåˆ†æã€DCTå˜æ¢</div>
                            <div class="feature"><strong>æ•°æ®åˆ†æ</strong><br>ç›´æ–¹å›¾ã€é¢‘è°±ã€è´¨é‡æŒ‡æ ‡</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">ğŸ“– ä½¿ç”¨æ–¹æ³•</div>
                    <div class="card-body intro">
                        <p>1. ä¸Šä¼ ä¸€å¼ å›¾ç‰‡<br>2. ç‚¹å‡»é€‰æ‹©éœ€è¦çš„å¤„ç†åŠŸèƒ½ï¼ˆæ”¯æŒå¤šé€‰ï¼‰<br>3. ç‚¹å‡»"å¼€å§‹å¤„ç†"æŒ‰é’®<br>4. åœ¨æ–°é¡µé¢æŸ¥çœ‹æ‰€æœ‰é€‰æ‹©åŠŸèƒ½çš„å¤„ç†ç»“æœ</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="footer">æ•°å­—å›¾åƒå¤„ç†åˆ†æç³»ç»Ÿ Â· æ­¦æ±‰è½»å·¥å¤§å­¦ Â· ç”µæ°”ä¸ç”µå­å·¥ç¨‹å­¦é™¢</div>

    <div class="loading" id="loading">
        <div class="spinner"></div>
        <p id="loadingText">æ­£åœ¨å¤„ç†...</p>
    </div>

    <script>
        let selectedFile = null;
        let selectedAlgos = new Set();

        const algoNames = {
            'threshold': 'å›ºå®šé˜ˆå€¼åˆ†å‰²', 'otsu': 'Otsué˜ˆå€¼', 'kmeans': 'K-meansèšç±»', 'watershed': 'åˆ†æ°´å²­',
            'histogram_eq': 'ç›´æ–¹å›¾å‡è¡¡åŒ–', 'clahe': 'CLAHE', 'gamma': 'ä¼½é©¬æ ¡æ­£', 'sharpen': 'é”åŒ–å¢å¼º', 'wiener': 'ç»´çº³æ»¤æ³¢',
            'edge_multi': 'å¤šç®—å­è¾¹ç¼˜æ£€æµ‹', 'canny': 'Cannyæ£€æµ‹',
            'denoise_multi': 'å¤šæ–¹æ³•å»å™ª', 'gaussian_denoise': 'é«˜æ–¯æ»¤æ³¢', 'median_denoise': 'ä¸­å€¼æ»¤æ³¢',
            'jpeg': 'JPEGå‹ç¼©', 'dct': 'DCTå˜æ¢'
        };

        document.getElementById('uploadBox').onclick = () => document.getElementById('fileInput').click();
        document.getElementById('fileInput').onchange = (e) => { if(e.target.files[0]) handleFile(e.target.files[0]); };
        
        document.getElementById('uploadBox').ondragover = (e) => { e.preventDefault(); };
        document.getElementById('uploadBox').ondrop = (e) => {
            e.preventDefault();
            if(e.dataTransfer.files[0]?.type.startsWith('image/')) handleFile(e.dataTransfer.files[0]);
        };

        function handleFile(file) {
            selectedFile = file;
            const reader = new FileReader();
            reader.onload = (e) => {
                document.getElementById('previewImg').src = e.target.result;
                document.getElementById('preview').classList.add('show');
                const img = new Image();
                img.onload = () => {
                    document.getElementById('fileInfo').textContent = file.name + ' Â· ' + img.width + 'Ã—' + img.height + ' Â· ' + (file.size/1024).toFixed(1) + 'KB';
                };
                img.src = e.target.result;
                updateBtn();
            };
            reader.readAsDataURL(file);
        }

        document.querySelectorAll('.algo-btn').forEach(btn => {
            btn.onclick = () => {
                const algo = btn.dataset.algo;
                if(selectedAlgos.has(algo)) {
                    selectedAlgos.delete(algo);
                    btn.classList.remove('selected');
                } else {
                    selectedAlgos.add(algo);
                    btn.classList.add('selected');
                }
                document.getElementById('selectedInfo').textContent = 'å·²é€‰æ‹© ' + selectedAlgos.size + ' ä¸ªåŠŸèƒ½';
                updateBtn();
            };
        });

        document.getElementById('clearBtn').onclick = () => {
            selectedAlgos.clear();
            document.querySelectorAll('.algo-btn').forEach(b => b.classList.remove('selected'));
            document.getElementById('selectedInfo').textContent = 'å·²é€‰æ‹© 0 ä¸ªåŠŸèƒ½';
            updateBtn();
        };

        function updateBtn() {
            document.getElementById('processBtn').disabled = !(selectedFile && selectedAlgos.size > 0);
        }

        document.getElementById('processBtn').onclick = async () => {
            if(!selectedFile || selectedAlgos.size === 0) return;
            
            const loading = document.getElementById('loading');
            const loadingText = document.getElementById('loadingText');
            loading.classList.add('show');
            
            const algos = Array.from(selectedAlgos);
            
            try {
                loadingText.textContent = 'æ­£åœ¨å¤„ç† ' + algos.length + ' ä¸ªåŠŸèƒ½...';
                
                const formData = new FormData();
                formData.append('image', selectedFile);
                formData.append('algorithms', JSON.stringify(algos));
                
                const response = await fetch('/process_batch', { method: 'POST', body: formData });
                const data = await response.json();
                
                loading.classList.remove('show');
                
                if(data.error) {
                    alert('å¤„ç†å¤±è´¥: ' + data.error);
                    return;
                }
                
                window.open('/result?id=' + data.result_id, '_blank');
            } catch(err) {
                loading.classList.remove('show');
                alert('å¤„ç†å¤±è´¥: ' + err.message);
            }
        };
    </script>
</body>
</html>
